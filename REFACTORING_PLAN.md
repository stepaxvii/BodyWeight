# üîß –ü–ª–∞–Ω –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ BodyWeight App

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 30.12.2024
**–í–µ—Ä—Å–∏—è**: 1.0
**–°—Ç–∞—Ç—É—Å**: –ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ú–µ—Ç—Ä–∏–∫–∏ –∏ –¶–µ–ª–∏](#–º–µ—Ç—Ä–∏–∫–∏-–∏-—Ü–µ–ª–∏)
3. [–§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è](#—Ñ–∞–∑–∞-1-–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
4. [–§–∞–∑–∞ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#—Ñ–∞–∑–∞-2-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
5. [–§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏–µ –ö–∞—á–µ—Å—Ç–≤–∞ –ö–æ–¥–∞](#—Ñ–∞–∑–∞-3-—É–ª—É—á—à–µ–Ω–∏–µ-–∫–∞—á–µ—Å—Ç–≤–∞-–∫–æ–¥–∞)
6. [–§–∞–∑–∞ 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ñ–∞–∑–∞-4-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è-–∏-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
7. [–†–∏—Å–∫–∏ –∏ –ú–∏—Ç–∏–≥–∞—Ü–∏—è](#—Ä–∏—Å–∫–∏-–∏-–º–∏—Ç–∏–≥–∞—Ü–∏—è)
8. [–ß–µ–∫–ª–∏—Å—Ç –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è](#—á–µ–∫–ª–∏—Å—Ç-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

---

## –û–±–∑–æ—Ä

### –¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ –ü—Ä–æ–µ–∫—Ç–∞

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
- Frontend: SvelteKit + Svelte 5 + TypeScript
- Backend: FastAPI + SQLAlchemy + SQLite
- Bot: Aiogram 3.4

**–†–∞–∑–º–µ—Ä –ö–æ–¥–æ–≤–æ–π –ë–∞–∑—ã**:
- Backend: 38 —Ñ–∞–π–ª–æ–≤ Python
- Frontend: 24 Svelte –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, 14 TypeScript —Ñ–∞–π–ª–æ–≤
- –í—Å–µ–≥–æ: ~15,000+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã**:
1. ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (~400 —Å—Ç—Ä–æ–∫)
2. ‚ùå –ù–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ü–µ–ª–µ–π (UserGoal)
3. ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
4. ‚ö†Ô∏è Mock data –≤ production –∫–æ–¥–µ
5. ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
6. ‚ö†Ô∏è N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –¶–µ–ª–∏

### –î–æ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –°—Ç—Ä–æ–∫ –≤ workouts.py | 779 |
| API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –¥–ª—è workout | 3 |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π | 3+ |
| Mock data —Å—Ç—Ä–æ–∫ | ~150 |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | 0 |
| N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ | 2+ –º–µ—Å—Ç–∞ |
| –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥ | ~500 —Å—Ç—Ä–æ–∫ |

### –¶–µ–ª–µ–≤—ã–µ –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|------|-----------|
| –°—Ç—Ä–æ–∫ –≤ workouts.py | ~450 | -42% |
| API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –¥–ª—è workout | 1 | -67% |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π | 0 | -100% |
| Mock data —Å—Ç—Ä–æ–∫ | 0 (–∏–∑–æ–ª—è—Ü–∏—è) | -100% |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | 3+ —Ç–∏–ø–∞ | ‚úÖ |
| N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ | 0 | ‚úÖ |
| –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥ | 0 | -100% |

---

## –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 3-5 –¥–Ω–µ–π
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

### 1.1 –£–¥–∞–ª–µ–Ω–∏–µ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è Workout Completion

**–ü—Ä–æ–±–ª–µ–º–∞**: –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º ~400 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞.

**–¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ**:
```python
# backend/app/api/routes/workouts.py

# –°–ø–æ—Å–æ–± 1 (Legacy) - —Å—Ç—Ä–æ–∫–∏ 233-508
@router.put("/{workout_id}/exercise")
async def add_exercise_to_workout(...)  # 140 —Å—Ç—Ä–æ–∫

@router.post("/{workout_id}/complete")
async def complete_workout(...)  # 130 —Å—Ç—Ä–æ–∫

# –°–ø–æ—Å–æ–± 2 (Recommended) - —Å—Ç—Ä–æ–∫–∏ 510-717
@router.post("/submit")
async def submit_workout(...)  # 200 —Å—Ç—Ä–æ–∫
```

**–ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π**:

#### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –û–±—â—É—é –§—É–Ω–∫—Ü–∏—é –û–±—Ä–∞–±–æ—Ç–∫–∏
```python
# backend/app/services/workout_processor.py (–ù–û–í–´–ô –§–ê–ô–õ)

from datetime import datetime, date, timedelta
from sqlalchemy.ext.asyncio import AsyncSession
from app.db.models import User, WorkoutSession, WorkoutExercise, Exercise
from app.services.xp_calculator import calculate_xp, calculate_coins
from app.services.achievement_checker import check_and_grant_achievements
from app.services.notification_service import create_notification

class WorkoutCompletionData:
    """DTO –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"""
    session_id: int
    user_id: int
    exercises: list[dict]  # {exercise_slug, reps, sets}
    started_at: datetime
    finished_at: datetime

async def process_workout_completion(
    data: WorkoutCompletionData,
    db: AsyncSession
) -> dict:
    """
    –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
        {
            "total_xp": int,
            "total_coins": int,
            "level_up": bool,
            "new_level": int,
            "new_achievements": list[str],
            "streak": int,
            "workout_summary": {...}
        }
    """

    # 1. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user = await db.get(User, data.user_id)

    # 2. –û–±–Ω–æ–≤–∏—Ç—å streak
    streak_info = await _update_user_streak(user, data.finished_at.date(), db)

    # 3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å first_of_day_bonus
    first_bonus = await _is_first_workout_today(user.id, data.finished_at, db)

    # 4. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å XP –∏ –º–æ–Ω–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
    total_xp = 0
    total_coins = 0
    workout_exercises = []

    for ex_data in data.exercises:
        exercise = await _get_exercise_by_slug(ex_data["exercise_slug"], db)

        xp_earned = calculate_xp(
            base_xp=exercise.base_xp,
            difficulty=exercise.difficulty,
            reps_or_duration=ex_data["reps"],
            streak_days=user.streak_days,
            first_of_day=first_bonus
        )

        coins_earned = calculate_coins(
            xp_earned=xp_earned,
            workout_duration_minutes=(data.finished_at - data.started_at).total_seconds() / 60
        )

        # –°–æ–∑–¥–∞—Ç—å WorkoutExercise
        we = WorkoutExercise(
            workout_session_id=data.session_id,
            exercise_id=exercise.id,
            sets_completed=ex_data["sets"],
            total_reps=ex_data["reps"],
            xp_earned=xp_earned,
            coins_earned=coins_earned
        )
        db.add(we)
        workout_exercises.append(we)

        total_xp += xp_earned
        total_coins += coins_earned

        # –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        await _update_exercise_progress(user.id, exercise.id, ex_data, db)

    # 5. –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    old_level = user.level
    user.total_xp += total_xp
    user.coins += total_coins
    user.level = calculate_level_from_xp(user.total_xp)

    level_up = user.level > old_level

    # –ë–æ–Ω—É—Å –∑–∞ level up
    if level_up:
        level_up_bonus = (user.level - old_level) * 5
        user.coins += level_up_bonus
        total_coins += level_up_bonus

    # 6. –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
    session = await db.get(WorkoutSession, data.session_id)
    session.finished_at = data.finished_at
    session.total_xp_earned = total_xp
    session.total_coins_earned = total_coins
    session.streak_multiplier = streak_info["multiplier"]

    # 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    new_achievements = await check_and_grant_achievements(user.id, db)

    # –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–µ—Ç—ã –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    for achievement_slug in new_achievements:
        achievement = await _get_achievement_data(achievement_slug)
        if achievement.get("coins_reward", 0) > 0:
            user.coins += achievement["coins_reward"]
            total_coins += achievement["coins_reward"]

    # 8. –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await _update_user_goals(user.id, data, db)

    # 9. –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    if level_up:
        await create_notification(
            user_id=user.id,
            notification_type="level_up",
            title=f"üéâ –£—Ä–æ–≤–µ–Ω—å {user.level}!",
            message=f"–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è {user.level}! –ü–æ–ª—É—á–µ–Ω–æ {level_up_bonus} –º–æ–Ω–µ—Ç.",
            db=db
        )

    for achievement_slug in new_achievements:
        achievement = await _get_achievement_data(achievement_slug)
        await create_notification(
            user_id=user.id,
            notification_type="achievement_unlocked",
            title=f"üèÜ {achievement['name_ru']}",
            message=achievement["description_ru"],
            db=db
        )

    await db.commit()

    return {
        "total_xp": total_xp,
        "total_coins": total_coins,
        "level_up": level_up,
        "old_level": old_level,
        "new_level": user.level,
        "new_achievements": new_achievements,
        "streak": user.streak_days,
        "streak_info": streak_info,
        "workout_summary": {
            "total_exercises": len(data.exercises),
            "total_reps": sum(ex["reps"] for ex in data.exercises),
            "total_sets": sum(ex["sets"] for ex in data.exercises),
            "duration_minutes": int((data.finished_at - data.started_at).total_seconds() / 60)
        }
    }


async def _update_user_streak(user: User, workout_date: date, db: AsyncSession) -> dict:
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ streak –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    # –õ–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á—ë—Ç–∞ streak...
    pass

async def _is_first_workout_today(user_id: int, workout_time: datetime, db: AsyncSession) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, –ø–µ—Ä–≤–∞—è –ª–∏ —ç—Ç–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è"""
    # –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏...
    pass

async def _get_exercise_by_slug(slug: str, db: AsyncSession) -> Exercise:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ slug"""
    # –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è...
    pass

async def _update_exercise_progress(user_id: int, exercise_id: int, ex_data: dict, db: AsyncSession):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è"""
    # –õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UserExerciseProgress...
    pass

async def _update_user_goals(user_id: int, data: WorkoutCompletionData, db: AsyncSession):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    # –õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UserGoal.current_value...
    pass

async def _get_achievement_data(slug: str) -> dict:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è"""
    # –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫—ç—à–∞...
    pass

def calculate_level_from_xp(total_xp: int) -> int:
    """–†–∞—Å—á—ë—Ç —É—Ä–æ–≤–Ω—è –∏–∑ XP"""
    # Level = floor(sqrt(total_xp / 100)) + 1
    import math
    return int(math.sqrt(total_xp / 100)) + 1
```

#### –®–∞–≥ 2: –£–ø—Ä–æ—Å—Ç–∏—Ç—å workouts.py
```python
# backend/app/api/routes/workouts.py (–ü–û–°–õ–ï –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–ê)

from app.services.workout_processor import process_workout_completion, WorkoutCompletionData

@router.post("/submit")
async def submit_workout(
    request: SubmitWorkoutRequest,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """
    –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.
    –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É.
    """

    # 1. –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
    session = WorkoutSession(
        user_id=current_user.id,
        started_at=request.started_at,
        finished_at=request.finished_at
    )
    db.add(session)
    await db.flush()

    # 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    completion_data = WorkoutCompletionData(
        session_id=session.id,
        user_id=current_user.id,
        exercises=request.exercises,
        started_at=request.started_at,
        finished_at=request.finished_at
    )

    # 3. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ –æ–±—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
    result = await process_workout_completion(completion_data, db)

    # 4. –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    return SubmitWorkoutResponse(
        workout_session_id=session.id,
        **result
    )


# ‚ùå –£–î–ê–õ–ò–¢–¨ —ç—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
# @router.put("/{workout_id}/exercise")
# async def add_exercise_to_workout(...)

# @router.post("/{workout_id}/complete")
# async def complete_workout(...)
```

#### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å Frontend
```typescript
// frontend/mini-app/src/lib/api/client.ts

// ‚ùå –£–î–ê–õ–ò–¢–¨:
// async startWorkout()
// async addExerciseToWorkout()
// async completeWorkout()

// ‚úÖ –û–°–¢–ê–í–ò–¢–¨ —Ç–æ–ª—å–∫–æ:
async submitWorkout(exercises: WorkoutExerciseInput[]): Promise<WorkoutResult> {
  const response = await this.fetch('/workouts/submit', {
    method: 'POST',
    body: JSON.stringify({
      started_at: this.workoutStartTime,
      finished_at: new Date().toISOString(),
      exercises: exercises
    })
  });
  return response.json();
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚ùå –£–¥–∞–ª–µ–Ω–æ: 2 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ + ~270 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ: 1 —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –£–ø—Ä–æ—â—ë–Ω workouts.py: 779 —Å—Ç—Ä–æ–∫ ‚Üí ~450 —Å—Ç—Ä–æ–∫

---

### 1.2 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¶–µ–ª–µ–π (UserGoal)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª–µ `UserGoal.current_value` –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

**–ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π**:

#### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –§—É–Ω–∫—Ü–∏—é –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –¶–µ–ª–µ–π
```python
# backend/app/services/workout_processor.py

async def _update_user_goals(
    user_id: int,
    data: WorkoutCompletionData,
    db: AsyncSession
):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ü–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""

    # –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ü–µ–ª–∏
    stmt = select(UserGoal).where(
        UserGoal.user_id == user_id,
        UserGoal.completed == False,
        UserGoal.end_date >= date.today()
    )
    result = await db.execute(stmt)
    goals = result.scalars().all()

    for goal in goals:
        old_value = goal.current_value

        if goal.goal_type == "total_workouts":
            goal.current_value += 1

        elif goal.goal_type == "total_reps":
            total_reps = sum(ex["reps"] for ex in data.exercises)
            goal.current_value += total_reps

        elif goal.goal_type == "total_xp":
            # XP –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
            # –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å total_xp
            pass

        elif goal.goal_type == "workout_streak":
            user = await db.get(User, user_id)
            goal.current_value = user.streak_days

        elif goal.goal_type.startswith("exercise_"):
            # –ù–∞–ø—Ä–∏–º–µ—Ä: exercise_pushup-regular_reps
            parts = goal.goal_type.split("_")
            if len(parts) >= 3:
                exercise_slug = "_".join(parts[1:-1])
                metric = parts[-1]

                for ex_data in data.exercises:
                    if ex_data["exercise_slug"] == exercise_slug:
                        if metric == "reps":
                            goal.current_value += ex_data["reps"]
                        elif metric == "sets":
                            goal.current_value += ex_data["sets"]

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        if goal.current_value >= goal.target_value and not goal.completed:
            goal.completed = True
            goal.completed_at = datetime.utcnow()

            # –°–æ–∑–¥–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            await create_notification(
                user_id=user_id,
                notification_type="goal_completed",
                title=f"üéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!",
                message=f"–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏: {goal.current_value}/{goal.target_value}",
                db=db
            )

            # –ù–∞–≥—Ä–∞–¥–∏—Ç—å –º–æ–Ω–µ—Ç–∞–º–∏
            user = await db.get(User, user_id)
            bonus_coins = 10  # –∏–ª–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ü–µ–ª–∏
            user.coins += bonus_coins
```

#### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –≠–Ω–¥–ø–æ–∏–Ω—Ç –ü—Ä–æ–≥—Ä–µ—Å—Å–∞ –¶–µ–ª–µ–π
```python
# backend/app/api/routes/goals.py

@router.get("/progress")
async def get_goals_progress(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ —Ü–µ–ª—è–º"""

    stmt = select(UserGoal).where(
        UserGoal.user_id == current_user.id
    ).order_by(UserGoal.completed.asc(), UserGoal.end_date.asc())

    result = await db.execute(stmt)
    goals = result.scalars().all()

    return [
        {
            "id": goal.id,
            "goal_type": goal.goal_type,
            "target_value": goal.target_value,
            "current_value": goal.current_value,
            "progress_percent": min(100, int(goal.current_value / goal.target_value * 100)),
            "completed": goal.completed,
            "completed_at": goal.completed_at,
            "end_date": goal.end_date,
            "days_remaining": (goal.end_date - date.today()).days
        }
        for goal in goals
    ]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –¶–µ–ª–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

---

### 1.3 –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è load_achievements()

**–ü—Ä–æ–±–ª–µ–º–∞**: –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ 2 –º–µ—Å—Ç–∞—Ö.

**–ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π**:

```python
# backend/app/utils/achievement_loader.py (–ù–û–í–´–ô –§–ê–ô–õ)

import json
from functools import lru_cache
from pathlib import Path
from typing import List, Dict

@lru_cache(maxsize=1)
def load_achievements() -> List[Dict]:
    """
    –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –∏–∑ JSON —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
    –ö—ç—à —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    """
    achievements_file = Path(__file__).parent.parent / "data" / "achievements.json"
    with open(achievements_file, "r", encoding="utf-8") as f:
        return json.load(f)

def get_achievement_by_slug(slug: str) -> Dict | None:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ slug"""
    achievements = load_achievements()
    return next((a for a in achievements if a["slug"] == slug), None)
```

```python
# backend/app/services/achievement_checker.py

# ‚ùå –£–î–ê–õ–ò–¢–¨ —Ñ—É–Ω–∫—Ü–∏—é load_achievements()
# ‚úÖ –ò–ú–ü–û–†–¢–ò–†–û–í–ê–¢–¨:
from app.utils.achievement_loader import load_achievements, get_achievement_by_slug
```

```python
# backend/app/api/routes/achievements.py

# ‚ùå –£–î–ê–õ–ò–¢–¨ —Ñ—É–Ω–∫—Ü–∏—é load_achievements()
# ‚úÖ –ò–ú–ü–û–†–¢–ò–†–û–í–ê–¢–¨:
from app.utils.achievement_loader import load_achievements, get_achievement_by_slug
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ @lru_cache
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

---

## –§–∞–∑–∞ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 2-3 –¥–Ω—è
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° –í–´–°–û–ö–ò–ô

### 2.1 –£–¥–∞–ª–µ–Ω–∏–µ/–ò–∑–æ–ª—è—Ü–∏—è Mock Data

**–ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π**:

```typescript
// frontend/mini-app/src/lib/api/mock-data.dev.ts (–ù–û–í–´–ô –§–ê–ô–õ)

/**
 * Mock data –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±–µ–∑ –±—ç–∫–µ–Ω–¥–∞.
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ DEV.
 */

export const MOCK_USER = { /* ... */ };
export const MOCK_CATEGORIES = [ /* ... */ ];
export const MOCK_EXERCISES = [ /* ... */ ];
// ...
```

```typescript
// frontend/mini-app/src/lib/api/client.ts

// ‚ùå –£–î–ê–õ–ò–¢–¨ –≤—Å–µ MOCK_* –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –æ—Ç—Å—é–¥–∞

// ‚úÖ –î–û–ë–ê–í–ò–¢–¨:
import { MOCK_USER, MOCK_EXERCISES, /* ... */ } from './mock-data.dev';

class ApiClient {
  private useMockData = import.meta.env.DEV && import.meta.env.VITE_USE_MOCKS === 'true';

  async getExercises(): Promise<Exercise[]> {
    if (this.useMockData) {
      return MOCK_EXERCISES;
    }
    // —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å...
  }
}
```

```bash
# .env.development
VITE_USE_MOCKS=false  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ Mock data –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ env-–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
- ‚úÖ –ù–µ –ø–æ–ø–∞–¥—ë—Ç –≤ production bundle
- ‚úÖ -150 —Å—Ç—Ä–æ–∫ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ client.ts

---

### 2.2 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –†–∞—Å—á—ë—Ç–∞ XP –Ω–∞ Frontend

**–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç XP –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º.

**–†–µ—à–µ–Ω–∏–µ 1 (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**: –£–±—Ä–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç
```typescript
// frontend/mini-app/src/lib/stores/workout.svelte.ts

// ‚ùå –£–î–ê–õ–ò–¢–¨:
// const totalXp = $derived.by(() => { /* —Å–ª–æ–∂–Ω—ã–π —Ä–∞—Å—á—ë—Ç */ });

// ‚úÖ –ü–û–ö–ê–ó–´–í–ê–¢–¨ –ø—Ä–∏–º–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
const estimatedXp = $derived.by(() => {
  return selectedExercises.reduce((sum, ex) => {
    const data = exerciseData.get(ex.id);
    return sum + (ex.base_xp * ex.difficulty * (data?.sets.length || 1));
  }, 0);
});

// –í UI:
// "–ü—Ä–∏–º–µ—Ä–Ω—ã–π XP: ~{estimatedXp}" —Å –∏–∫–æ–Ω–∫–æ–π "?"
```

**–†–µ—à–µ–Ω–∏–µ 2 (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)**: –≠–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
```python
# backend/app/api/routes/workouts.py

@router.post("/preview")
async def preview_workout_xp(
    request: PreviewWorkoutRequest,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç XP –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"""

    total_xp = 0
    for ex in request.exercises:
        exercise = await get_exercise_by_slug(ex.exercise_slug, db)
        xp = calculate_xp(
            base_xp=exercise.base_xp,
            difficulty=exercise.difficulty,
            reps_or_duration=ex.reps,
            streak_days=current_user.streak_days,
            first_of_day=True  # –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º
        )
        total_xp += xp

    return {"estimated_xp": total_xp}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ—á–Ω—ã–π –∏–ª–∏ —á–µ—Å—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä–Ω—ã–π XP
- ‚úÖ –ù–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –º–µ–∂–¥—É frontend –∏ backend
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ workout store

---

### 2.3 –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ N+1 –ó–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –í `get_friends_leaderboard()` –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç N+1 –∑–∞–ø—Ä–æ—Å—ã.

```python
# backend/app/api/routes/leaderboard.py

# ‚ùå –ë–´–õ–û:
@router.get("/friends")
async def get_friends_leaderboard(...):
    friendships = await db.execute(
        select(Friendship).where(...)
    )

    leaderboard = []
    for friendship in friendships.scalars():
        friend = await db.get(User, friendship.friend_id)  # ‚Üê N+1!
        leaderboard.append({...})

# ‚úÖ –°–¢–ê–õ–û:
@router.get("/friends")
async def get_friends_leaderboard(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """Leaderboard —Å—Ä–µ–¥–∏ –¥—Ä—É–∑–µ–π —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º"""

    # –û–¥–∏–Ω JOIN –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N+1
    stmt = (
        select(User)
        .join(
            Friendship,
            (Friendship.friend_id == User.id) & (Friendship.user_id == current_user.id)
            | (Friendship.user_id == User.id) & (Friendship.friend_id == current_user.id)
        )
        .where(Friendship.status == "accepted")
        .order_by(User.total_xp.desc())
        .limit(50)
    )

    result = await db.execute(stmt)
    friends = result.scalars().all()

    # –î–æ–±–∞–≤–∏—Ç—å —Å–µ–±—è –≤ —Å–ø–∏—Å–æ–∫
    friends_with_me = [current_user] + list(friends)
    friends_with_me.sort(key=lambda u: u.total_xp, reverse=True)

    return [
        LeaderboardEntry(
            rank=idx + 1,
            user_id=user.id,
            telegram_id=user.telegram_id,
            username=user.username or "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
            total_xp=user.total_xp,
            level=user.level,
            avatar_id=user.avatar_id,
            is_current_user=(user.id == current_user.id)
        )
        for idx, user in enumerate(friends_with_me)
    ]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ 1 –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N+1
- ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ leaderboard –≤ N —Ä–∞–∑

---

### 2.4 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# backend/app/utils/cache.py (–ù–û–í–´–ô –§–ê–ô–õ)

from functools import lru_cache, wraps
from typing import Callable, Any
import time

def timed_cache(seconds: int = 300):
    """Decorator –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å TTL"""
    def decorator(func: Callable) -> Callable:
        cache = {}
        cache_time = {}

        @wraps(func)
        async def wrapper(*args, **kwargs):
            # –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á –∫—ç—à–∞
            cache_key = str(args) + str(kwargs)

            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
            if cache_key in cache:
                if time.time() - cache_time[cache_key] < seconds:
                    return cache[cache_key]

            # –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
            result = await func(*args, **kwargs)

            # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à
            cache[cache_key] = result
            cache_time[cache_key] = time.time()

            return result

        return wrapper
    return decorator
```

```python
# backend/app/api/routes/exercises.py

from app.utils.cache import timed_cache

@router.get("")
@timed_cache(seconds=300)  # –ö—ç—à –Ω–∞ 5 –º–∏–Ω—É—Ç
async def get_exercises(
    db: AsyncSession = Depends(get_db)
):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    stmt = select(Exercise).order_by(Exercise.name)
    result = await db.execute(stmt)
    return result.scalars().all()

@router.get("/categories")
@timed_cache(seconds=600)  # –ö—ç—à –Ω–∞ 10 –º–∏–Ω—É—Ç
async def get_categories(
    db: AsyncSession = Depends(get_db)
):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    stmt = select(ExerciseCategory).order_by(ExerciseCategory.sort_order)
    result = await db.execute(stmt)
    return result.scalars().all()
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (Redis)**:
```python
# backend/app/config.py
redis_url: str = "redis://localhost:6379"

# backend/app/main.py
from redis.asyncio import Redis

@asynccontextmanager
async def lifespan(app: FastAPI):
    # Startup
    app.state.redis = Redis.from_url(settings.redis_url)
    yield
    # Shutdown
    await app.state.redis.close()

# backend/app/api/routes/exercises.py
@router.get("")
async def get_exercises(
    request: Request,
    db: AsyncSession = Depends(get_db)
):
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à
    cached = await request.app.state.redis.get("exercises:all")
    if cached:
        return json.loads(cached)

    # –ó–∞–ø—Ä–æ—Å –∫ –ë–î
    result = await db.execute(select(Exercise))
    exercises = result.scalars().all()

    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à –Ω–∞ 5 –º–∏–Ω—É—Ç
    await request.app.state.redis.setex(
        "exercises:all",
        300,
        json.dumps([ex.dict() for ex in exercises])
    )

    return exercises
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ Exercises –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç
- ‚úÖ Categories –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 10 –º–∏–Ω—É—Ç
- ‚úÖ Achievements –∫—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞ (@lru_cache)
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î

---

## –§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏–µ –ö–∞—á–µ—Å—Ç–≤–∞ –ö–æ–¥–∞

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 3-4 –¥–Ω—è
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü¢ –°–†–ï–î–ù–ò–ô

### 3.1 –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è Response Models

```python
# backend/app/schemas/user.py (–ù–û–í–´–ô –§–ê–ô–õ)

from pydantic import BaseModel
from datetime import datetime

class UserBase(BaseModel):
    telegram_id: int
    username: str | None
    first_name: str | None
    last_name: str | None

class UserResponse(UserBase):
    id: int
    level: int
    total_xp: int
    coins: int
    streak_days: int
    avatar_id: int
    is_onboarded: bool
    created_at: datetime

    class Config:
        from_attributes = True

class UserStatsResponse(BaseModel):
    total_xp: int
    total_workouts: int
    total_reps: int
    total_time_minutes: int
    current_streak: int
    longest_streak: int
    level: int
    xp_to_next_level: int
    xp_progress_percent: float
    favorite_exercise: str | None
    favorite_category: str | None
```

```python
# backend/app/api/routes/auth.py
# ‚ùå –£–î–ê–õ–ò–¢–¨: class UserResponse

# ‚úÖ –ò–ú–ü–û–†–¢–ò–†–û–í–ê–¢–¨:
from app.schemas.user import UserResponse

# backend/app/api/routes/users.py
# ‚úÖ –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ —Ç—É –∂–µ —Å—Ö–µ–º—É:
from app.schemas.user import UserResponse, UserStatsResponse
```

**–°–æ–∑–¥–∞—Ç—å –ï–¥–∏–Ω—ã–µ –°—Ö–µ–º—ã**:
```
backend/app/schemas/
‚îú‚îÄ‚îÄ user.py          # UserResponse, UserStatsResponse, etc.
‚îú‚îÄ‚îÄ exercise.py      # ExerciseResponse, ExerciseCategoryResponse
‚îú‚îÄ‚îÄ workout.py       # WorkoutSessionResponse, SubmitWorkoutRequest, etc.
‚îú‚îÄ‚îÄ achievement.py   # AchievementResponse, UserAchievementResponse
‚îú‚îÄ‚îÄ leaderboard.py   # LeaderboardEntry
‚îî‚îÄ‚îÄ __init__.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ö–µ–º
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏

---

### 3.2 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è TypeScript –¢–∏–ø–æ–≤

```typescript
// frontend/mini-app/src/lib/types.ts

// ‚úÖ –°–ò–ù–•–†–û–ù–ò–ó–ò–†–û–í–ê–¢–¨ —Å backend/app/schemas/user.py
export interface UserStats {
  total_xp: number;
  total_workouts: number;
  total_reps: number;
  total_time_minutes: number;
  current_streak: number;
  longest_streak: number;
  level: number;
  xp_to_next_level: number;
  xp_progress_percent: number;
  favorite_exercise: string | null;
  favorite_category: string | null;
}
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å openapi-typescript
npm install -D openapi-typescript

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã –∏–∑ OpenAPI —Å—Ö–µ–º—ã
npx openapi-typescript http://localhost:8000/openapi.json -o src/lib/api/schema.d.ts
```

```typescript
// frontend/mini-app/src/lib/api/client.ts
import type { paths } from './schema';

type GetExercisesResponse = paths['/api/exercises']['get']['responses']['200']['content']['application/json'];
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ 100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ Frontend ‚Üî Backend —Ç–∏–ø–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ API

---

### 3.3 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ü–∞–≥–∏–Ω–∞—Ü–∏–∏

```python
# backend/app/api/routes/exercises.py

from fastapi import Query

@router.get("")
async def get_exercises(
    skip: int = Query(0, ge=0),
    limit: int = Query(50, ge=1, le=100),
    db: AsyncSession = Depends(get_db)
):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π"""

    # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    count_stmt = select(func.count()).select_from(Exercise)
    total = await db.scalar(count_stmt)

    # –ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å
    stmt = (
        select(Exercise)
        .order_by(Exercise.name)
        .offset(skip)
        .limit(limit)
    )
    result = await db.execute(stmt)
    exercises = result.scalars().all()

    return {
        "items": exercises,
        "total": total,
        "skip": skip,
        "limit": limit,
        "has_more": skip + limit < total
    }
```

```python
# backend/app/api/routes/workouts.py

@router.get("/history")
async def get_workout_history(
    skip: int = Query(0, ge=0),
    limit: int = Query(20, ge=1, le=100),
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π"""

    count_stmt = (
        select(func.count())
        .select_from(WorkoutSession)
        .where(WorkoutSession.user_id == current_user.id)
    )
    total = await db.scalar(count_stmt)

    stmt = (
        select(WorkoutSession)
        .where(WorkoutSession.user_id == current_user.id)
        .order_by(WorkoutSession.finished_at.desc())
        .offset(skip)
        .limit(limit)
        .options(selectinload(WorkoutSession.exercises))
    )
    result = await db.execute(stmt)
    sessions = result.scalars().all()

    return {
        "items": sessions,
        "total": total,
        "skip": skip,
        "limit": limit,
        "has_more": skip + limit < total
    }
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –∏ —Å–µ—Ç—å
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ UX (infinite scroll)

---

### 3.4 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ò–Ω–¥–µ–∫—Å–æ–≤ –ë–î

```python
# backend/alembic/versions/xxx_add_performance_indexes.py

def upgrade():
    # –ò–Ω–¥–µ–∫—Å –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –¥—Ä—É–∑–µ–π –ø–æ —Å—Ç–∞—Ç—É—Å—É
    op.create_index(
        'ix_friendship_user_status',
        'friendships',
        ['user_id', 'status']
    )

    # –ò–Ω–¥–µ–∫—Å –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
    op.create_index(
        'ix_workout_sessions_user_finished',
        'workout_sessions',
        ['user_id', 'finished_at']
    )

    # –ò–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    op.create_index(
        'ix_user_achievements_user_unlocked',
        'user_achievements',
        ['user_id', 'unlocked_at']
    )

    # –ò–Ω–¥–µ–∫—Å –¥–ª—è —Ü–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    op.create_index(
        'ix_user_goals_user_completed',
        'user_goals',
        ['user_id', 'completed', 'end_date']
    )

def downgrade():
    op.drop_index('ix_friendship_user_status')
    op.drop_index('ix_workout_sessions_user_finished')
    op.drop_index('ix_user_achievements_user_unlocked')
    op.drop_index('ix_user_goals_user_completed')
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –£—Å–∫–æ—Ä–µ–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î

---

### 3.5 –£—Å–ª–æ–≤–Ω–æ–µ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# backend/app/api/routes/leaderboard.py

# ‚ùå –ë–´–õ–û:
logger.warning(f"Found {len(top_users)} users")
logger.info(f"Processing user {user.id}")

# ‚úÖ –°–¢–ê–õ–û:
from app.config import settings

if settings.debug:
    logger.debug(f"Found {len(top_users)} users")
    logger.debug(f"Processing user {user.id}")

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å logger:
logger.debug(f"Found {len(top_users)} users")  # –ù–µ –±—É–¥–µ—Ç –≤ production
```

```python
# backend/app/config.py

class Settings(BaseSettings):
    debug: bool = False
    log_level: str = "INFO"  # DEBUG –≤ dev, INFO –≤ prod
```

```python
# backend/app/main.py

import logging

logging.basicConfig(
    level=settings.log_level,
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s"
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ß–∏—Å—Ç—ã–µ –ª–æ–≥–∏ –≤ production
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ development

---

## –§–∞–∑–∞ 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 2-3 –¥–Ω—è
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü¢ –°–†–ï–î–ù–ò–ô

### 4.1 API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```python
# backend/app/main.py

app = FastAPI(
    title="BodyWeight Fitness API",
    description="API –¥–ª—è Telegram Mini App —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–∫–µ—Ä–∞ —Å –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–µ–π",
    version="2.0.0",
    docs_url="/api/docs",
    redoc_url="/api/redoc"
)
```

```python
# backend/app/api/routes/workouts.py

@router.post("/submit",
    summary="–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É",
    description="""
    –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.

    –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ —Å—Ä–∞–∑—É:
    - –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
    - –°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏/–ø–æ–¥—Ö–æ–¥–∞–º–∏

    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç XP –∏ –º–æ–Ω–µ—Ç—ã
    - –û–±–Ω–æ–≤–ª—è–µ—Ç streak
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–ª–∏
    - –°–æ–∑–¥–∞—ë—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    """,
    response_description="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏",
    tags=["Workouts"]
)
async def submit_workout(...):
    ...
```

**–°–æ–∑–¥–∞—Ç—å README –¥–ª—è API**:
```markdown
# BodyWeight API

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:
```
Authorization: tma <telegram_init_data>
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏

**POST /api/workouts/submit** - –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
```json
{
  "started_at": "2024-12-30T10:00:00Z",
  "finished_at": "2024-12-30T10:30:00Z",
  "exercises": [
    {
      "exercise_slug": "pushup-regular",
      "reps": 50,
      "sets": 3
    }
  ]
}
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "workout_session_id": 123,
  "total_xp": 250,
  "total_coins": 2,
  "level_up": true,
  "new_level": 5,
  "new_achievements": ["first-workout"],
  "streak": 7
}
```

...
```

---

### 4.2 Unit –¢–µ—Å—Ç—ã

```python
# backend/tests/test_workout_processor.py

import pytest
from datetime import datetime, timedelta
from app.services.workout_processor import process_workout_completion, WorkoutCompletionData
from app.db.models import User, Exercise, WorkoutSession

@pytest.mark.asyncio
async def test_workout_completion_basic(db_session):
    """–¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"""

    # –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user = User(
        telegram_id=12345,
        username="testuser",
        level=1,
        total_xp=0,
        coins=0,
        streak_days=0
    )
    db_session.add(user)
    await db_session.flush()

    # –°–æ–∑–¥–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
    exercise = Exercise(
        slug="pushup-regular",
        name="Push-up",
        base_xp=10,
        difficulty=2
    )
    db_session.add(exercise)
    await db_session.flush()

    # –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
    session = WorkoutSession(
        user_id=user.id,
        started_at=datetime.utcnow() - timedelta(minutes=30)
    )
    db_session.add(session)
    await db_session.flush()

    # –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    data = WorkoutCompletionData(
        session_id=session.id,
        user_id=user.id,
        exercises=[
            {"exercise_slug": "pushup-regular", "reps": 20, "sets": 3}
        ],
        started_at=session.started_at,
        finished_at=datetime.utcnow()
    )

    # –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É
    result = await process_workout_completion(data, db_session)

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    assert result["total_xp"] > 0
    assert result["total_coins"] >= 0
    assert result["streak"] == 1

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await db_session.refresh(user)
    assert user.total_xp > 0
    assert user.level >= 1


@pytest.mark.asyncio
async def test_workout_goal_update(db_session):
    """–¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–ª–µ–π –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"""

    user = User(...)
    db_session.add(user)
    await db_session.flush()

    # –°–æ–∑–¥–∞—Ç—å —Ü–µ–ª—å
    goal = UserGoal(
        user_id=user.id,
        goal_type="total_workouts",
        target_value=10,
        current_value=0,
        start_date=date.today(),
        end_date=date.today() + timedelta(days=30)
    )
    db_session.add(goal)
    await db_session.flush()

    # –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
    data = WorkoutCompletionData(...)
    result = await process_workout_completion(data, db_session)

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–∏
    await db_session.refresh(goal)
    assert goal.current_value == 1
    assert goal.completed == False


@pytest.mark.asyncio
async def test_workout_level_up(db_session):
    """–¢–µ—Å—Ç –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è"""

    user = User(
        total_xp=90,  # –ë–ª–∏–∑–∫–æ –∫ level 2 (—Ç—Ä–µ–±—É–µ—Ç—Å—è 100 XP)
        level=1
    )
    db_session.add(user)
    await db_session.flush()

    # –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º XP
    data = WorkoutCompletionData(...)
    result = await process_workout_completion(data, db_session)

    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å level up
    assert result["level_up"] == True
    assert result["new_level"] == 2
    await db_session.refresh(user)
    assert user.level == 2
    assert user.coins > 0  # –ü–æ–ª—É—á–µ–Ω—ã –±–æ–Ω—É—Å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–π

---

### 4.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
# frontend/scripts/find-unused-components.sh

#!/bin/bash

echo "Checking component usage..."

for file in frontend/mini-app/src/lib/components/*.svelte; do
    component=$(basename "$file" .svelte)

    # –ü–æ–∏—Å–∫ –∏–º–ø–æ—Ä—Ç–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    usage_count=$(grep -r "import.*$component" frontend/mini-app/src --include="*.svelte" --include="*.ts" | wc -l)

    if [ $usage_count -eq 0 ]; then
        echo "‚ö†Ô∏è  UNUSED: $component"
    else
        echo "‚úÖ USED ($usage_count): $component"
    fi
done
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞**:
```
‚úÖ USED (3): CustomRoutineEditor
‚úÖ USED (2): CustomRoutineList
‚úÖ USED (5): ExerciseCard
‚úÖ USED (2): ExerciseInfoModal
‚úÖ USED (1): FilterModal
‚úÖ USED (1): OnboardingScreen
‚úÖ USED (1): OnboardingSlides
‚ö†Ô∏è  UNUSED: QuickExerciseModal  ‚Üê –ö–ê–ù–î–ò–î–ê–¢ –ù–ê –£–î–ê–õ–ï–ù–ò–ï
‚úÖ USED (4): RoutinePlayer
‚úÖ USED (1): UserProfileModal
```

**–î–µ–π—Å—Ç–≤–∏—è**:
```bash
# –ï—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
rm frontend/mini-app/src/lib/components/QuickExerciseModal.svelte
```

---

## –†–∏—Å–∫–∏ –∏ –ú–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –ü–æ–ª–æ–º–∫–∞ –°—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è
**–í–ª–∏—è–Ω–∏–µ**: –í—ã—Å–æ–∫–æ–µ

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å comprehensive —Ç–µ—Å—Ç—ã –ü–ï–†–ï–î —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å feature flags –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
3. ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∫–∞–∫ deprecated –Ω–∞ 1-2 –Ω–µ–¥–µ–ª–∏
4. ‚úÖ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ staging –æ–∫—Ä—É–∂–µ–Ω–∏–∏

```python
# –ü—Ä–∏–º–µ—Ä feature flag
from app.config import settings

@router.post("/submit")
async def submit_workout(...):
    if not settings.feature_new_workout_flow:
        raise HTTPException(503, "New workflow not enabled")
    ...

# –°—Ç–∞—Ä—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–º–µ—á–∞–µ–º deprecated
@router.post("/{workout_id}/complete", deprecated=True)
async def complete_workout(...):
    logger.warning("Using deprecated endpoint /complete")
    ...
```

---

### –†–∏—Å–∫ 2: –ü–æ—Ç–µ—Ä—è –î–∞–Ω–Ω—ã—Ö –ü—Ä–∏ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –ù–∏–∑–∫–∞—è
**–í–ª–∏—è–Ω–∏–µ**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π backup –ë–î –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
2. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –∫–æ–ø–∏–∏ production –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ alembic
4. ‚úÖ –ò–º–µ—Ç—å rollback –ø–ª–∞–Ω

```bash
# Backup –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
sqlite3 database.db .dump > backup_$(date +%Y%m%d_%H%M%S).sql

# –¢–µ—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head --sql > migration.sql  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQL
alembic upgrade head  # –ü—Ä–∏–º–µ–Ω–∏—Ç—å

# Rollback –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º
alembic downgrade -1
```

---

### –†–∏—Å–∫ 3: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –í—Ä–µ–º–µ–Ω–∏ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –í—ã—Å–æ–∫–∞—è
**–í–ª–∏—è–Ω–∏–µ**: –°—Ä–µ–¥–Ω–µ–µ

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
1. ‚úÖ –ß—ë—Ç–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è (—ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç!)
2. ‚úÖ –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ small incremental changes
3. ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
4. ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ scope - –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏ –≤–æ –≤—Ä–µ–º—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

---

### –†–∏—Å–∫ 4: –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å Frontend ‚Üî Backend

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è
**–í–ª–∏—è–Ω–∏–µ**: –í—ã—Å–æ–∫–æ–µ

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
1. ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API (`/api/v1`, `/api/v2`)
2. ‚úÖ Backwards compatibility –ø–µ—Ä–∏–æ–¥
3. ‚úÖ Integration —Ç–µ—Å—Ç—ã Frontend + Backend
4. ‚úÖ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è TypeScript —Ç–∏–ø–æ–≤ –∏–∑ OpenAPI

```python
# –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API
from fastapi import APIRouter

v1_router = APIRouter(prefix="/api/v1")
v2_router = APIRouter(prefix="/api/v2")

# v2 - –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
@v2_router.post("/workouts/submit")
async def submit_workout_v2(...):
    ...

# v1 - —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ (deprecated)
@v1_router.post("/workouts")
async def create_workout_v1(...):
    ...
```

---

## –ß–µ–∫–ª–∏—Å—Ç –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚úÖ

- [ ] 1.1 –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ workout completion
  - [ ] –°–æ–∑–¥–∞—Ç—å `backend/app/services/workout_processor.py`
  - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `process_workout_completion()`
  - [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å `workouts.py` –¥–æ 1 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
  - [ ] –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å frontend API client
  - [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
  - [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ staging

- [ ] 1.2 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UserGoal
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `_update_user_goals()` –≤ processor
  - [ ] –°–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `/goals/progress`
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å frontend –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
  - [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã

- [ ] 1.3 –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ load_achievements()
  - [ ] –°–æ–∑–¥–∞—Ç—å `backend/app/utils/achievement_loader.py`
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ achievement_checker.py
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ routes/achievements.py
  - [ ] –î–æ–±–∞–≤–∏—Ç—å @lru_cache

### –§–∞–∑–∞ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ‚úÖ

- [ ] 2.1 –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å Mock Data
  - [ ] –°–æ–∑–¥–∞—Ç—å `frontend/mini-app/src/lib/api/mock-data.dev.ts`
  - [ ] –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤—Å–µ MOCK_* –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å client.ts —Å —É—Å–ª–æ–≤–Ω—ã–º –∏–º–ø–æ—Ä—Ç–æ–º
  - [ ] –î–æ–±–∞–≤–∏—Ç—å env –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é VITE_USE_MOCKS

- [ ] 2.2 –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á—ë—Ç XP –Ω–∞ frontend
  - [ ] –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ estimated
  - [ ] –ò–õ–ò —Å–æ–∑–¥–∞—Ç—å `/workouts/preview` —ç–Ω–¥–ø–æ–∏–Ω—Ç
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å UI —Å –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏

- [ ] 2.3 –£—Å—Ç—Ä–∞–Ω–∏—Ç—å N+1 –∑–∞–ø—Ä–æ—Å—ã
  - [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `get_friends_leaderboard()`
  - [ ] –î–æ–±–∞–≤–∏—Ç—å JOIN –∑–∞–ø—Ä–æ—Å—ã
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- [ ] 2.4 –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
  - [ ] –°–æ–∑–¥–∞—Ç—å `backend/app/utils/cache.py`
  - [ ] –î–æ–±–∞–≤–∏—Ç—å @timed_cache –¥–ª—è exercises
  - [ ] –î–æ–±–∞–≤–∏—Ç—å @timed_cache –¥–ª—è categories
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å load_achievements –∫—ç—à

### –§–∞–∑–∞ 3: –ö–∞—á–µ—Å—Ç–≤–æ –ö–æ–¥–∞ ‚úÖ

- [ ] 3.1 –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å Response Models
  - [ ] –°–æ–∑–¥–∞—Ç—å `backend/app/schemas/`
  - [ ] –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤—Å–µ —Å—Ö–µ–º—ã
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã

- [ ] 3.2 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å TypeScript —Ç–∏–ø—ã
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å `frontend/mini-app/src/lib/types.ts`
  - [ ] –ò–õ–ò –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑ OpenAPI

- [ ] 3.3 –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
  - [ ] `/exercises` —Å skip/limit
  - [ ] `/workouts/history` —Å skip/limit
  - [ ] `/achievements` —Å skip/limit
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å frontend –¥–ª—è infinite scroll

- [ ] 3.4 –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –ë–î
  - [ ] –°–æ–∑–¥–∞—Ç—å alembic –º–∏–≥—Ä–∞—Ü–∏—é
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –ø–æ–ª—è
  - [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

- [ ] 3.5 –£—Å–ª–æ–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  - [ ] –ó–∞–º–µ–Ω–∏—Ç—å logger.warning/info –Ω–∞ logger.debug
  - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –§–∞–∑–∞ 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ

- [ ] 4.1 API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
  - [ ] –°–æ–∑–¥–∞—Ç—å README_API.md
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Swagger UI

- [ ] 4.2 Unit –¢–µ—Å—Ç—ã
  - [ ] –¢–µ—Å—Ç—ã –¥–ª—è workout_processor
  - [ ] –¢–µ—Å—Ç—ã –¥–ª—è goal updates
  - [ ] –¢–µ—Å—Ç—ã –¥–ª—è achievement checking
  - [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ > 70%

- [ ] 4.3 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø–æ–∏—Å–∫–∞
  - [ ] –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ

---

## –ú–µ—Ç—Ä–∏–∫–∏ –£—Å–ø–µ—Ö–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å:

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –¶–µ–ª—å | –ú–µ—Ç–æ–¥ –ü—Ä–æ–≤–µ—Ä–∫–∏ |
|----------|------|----------------|
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤ workouts.py | < 500 | `wc -l workouts.py` |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ | 0% | Manual review |
| –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ | > 70% | `pytest --cov` |
| –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API | < 200ms | Load testing |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ | 3+ | Check cache hits |
| N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ | 0 | SQL query logging |
| API –≤–µ—Ä—Å–∏—è | 2.0.0 | OpenAPI spec |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 100% endpoints | Swagger UI |

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ **10-14 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π** (2-3 –Ω–µ–¥–µ–ª–∏).

**–û–∂–∏–¥–∞–µ–º—ã–µ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
- üéØ -500 —Å—Ç—Ä–æ–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞
- üöÄ –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 30-50%
- üßπ –ß–∏—Å—Ç–∞—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ü–µ–ª–µ–π
- üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- üß™ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 70%

**–°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏**:
1. ‚úÖ –£—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞–Ω
2. üîß –°–æ–∑–¥–∞—Ç—å feature branch `refactoring/phase-1`
3. üìù –ù–∞—á–∞—Ç—å —Å –§–∞–∑—ã 1, –∑–∞–¥–∞—á–∞ 1.1
4. üîÑ Code review –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
5. üöÄ Deploy –≤ staging –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã
6. ‚ú® –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑ –ø–æ—Å–ª–µ –§–∞–∑—ã 4

---

**–í–µ—Ä—Å–∏—è**: 1.0
**–î–∞—Ç–∞**: 30.12.2024
**–ê–≤—Ç–æ—Ä**: Claude Code Review
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
