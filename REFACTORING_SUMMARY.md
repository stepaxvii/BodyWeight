# üìä –ö—Ä–∞—Ç–∫–æ–µ –†–µ–∑—é–º–µ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ BodyWeight

> –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è: [REFACTORING_PLAN.md](./REFACTORING_PLAN.md)

---

## üéØ –ì–ª–∞–≤–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å)

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ 400 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** –≤ workouts.py
   - –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
   - **–†–µ—à–µ–Ω–∏–µ**: –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `/workouts/submit`

2. **–¶–µ–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç** (UserGoal.current_value –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
   - **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å `_update_user_goals()` –≤ workout processor

3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** (load_achievements –≤ 2 –º–µ—Å—Ç–∞—Ö)
   - **–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π `utils/achievement_loader.py`

### üü° –í–∞–∂–Ω—ã–µ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∫–æ—Ä–æ)

4. **Mock data –≤ production** (~150 —Å—Ç—Ä–æ–∫)
   - **–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ `mock-data.dev.ts`

5. **–ù–µ—Ç–æ—á–Ω—ã–π XP –Ω–∞ frontend**
   - **–†–µ—à–µ–Ω–∏–µ**: –£–±—Ä–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å `/preview`

6. **N+1 –∑–∞–ø—Ä–æ—Å—ã** –≤ leaderboard
   - **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JOIN –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–æ–≤

7. **–ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è** —Å—Ç–∞—Ç–∏–∫–∏
   - **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å @lru_cache –∏ timed_cache

### üü¢ –£–ª—É—á—à–µ–Ω–∏—è (—Å–¥–µ–ª–∞—Ç—å –ø–æ—Ç–æ–º)

8. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø—ã Frontend ‚Üî Backend
9. –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
10. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å Response Models
11. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –ë–î
12. –£—Å–ª–æ–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìÖ –ü–ª–∞–Ω –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ù–µ–¥–µ–ª—è 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ü—Ä–æ–±–ª–µ–º—ã
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ workout completion (-400 —Å—Ç—Ä–æ–∫)
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–ª–µ–π
- [ ] –í—ã–Ω–æ—Å load_achievements –≤ utils

### –ù–µ–¥–µ–ª—è 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –ò–∑–æ–ª—è—Ü–∏—è mock data
- [ ] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á—ë—Ç–∞ XP
- [ ] –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ N+1
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### –ù–µ–¥–µ–ª—è 3: –ö–∞—á–µ—Å—Ç–≤–æ
- [ ] –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ö–µ–º
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è
- [ ] –ò–Ω–¥–µ–∫—Å—ã –ë–î
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è + —Ç–µ—Å—Ç—ã

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–π –†–µ–∑—É–ª—å—Ç–∞—Ç

| –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|----|-------|-----------|
| 779 —Å—Ç—Ä–æ–∫ –≤ workouts.py | ~450 | **-42%** |
| 3 API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ | 1 | **-67%** |
| ~150 —Å—Ç—Ä–æ–∫ mock | 0 | **-100%** |
| 0 –∫—ç—à–∞ | 3+ —Ç–∏–ø–∞ | **‚úÖ** |
| N+1 –∑–∞–ø—Ä–æ—Å—ã | –ù–µ—Ç | **‚úÖ** |
| –¶–µ–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç | –†–∞–±–æ—Ç–∞—é—Ç | **‚úÖ** |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç

### –®–∞–≥ 1: Backup
```bash
sqlite3 database.db .dump > backup_$(date +%Y%m%d).sql
git checkout -b refactoring/phase-1
```

### –®–∞–≥ 2: –ù–∞—á–∞—Ç—å —Å –ö—Ä–∏—Ç–∏—á–Ω–æ–≥–æ
```bash
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
touch backend/app/services/workout_processor.py

# –ù–∞–ø–∏—Å–∞—Ç—å process_workout_completion()
# –£–ø—Ä–æ—Å—Ç–∏—Ç—å workouts.py
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
pytest backend/tests/test_workout_processor.py
curl http://localhost:8000/api/workouts/submit
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –†–∏—Å–∫–∏

1. **–ü–æ–ª–æ–º–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: Comprehensive —Ç–µ—Å—Ç—ã + feature flags

2. **–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (`/api/v2`) + deprecated –ø–µ—Ä–∏–æ–¥

3. **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö**
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: Backup –ë–î + rollback –ø–ª–∞–Ω

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –£—Å–ø–µ—Ö–∞

- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ 30-50%
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 70%
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ –¶–µ–ª–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞

---

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 2-3 –Ω–µ–¥–µ–ª–∏
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –í—ã—Å–æ–∫–∏–π
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤ –∫ —Å—Ç–∞—Ä—Ç—É

üëâ [–ü–æ–ª–Ω—ã–π –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞](./REFACTORING_PLAN.md)
