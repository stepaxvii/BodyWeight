# BodyWeight - Обзор платформы

**Версия**: 3.4
**Платформа**: Telegram Mini App
**Стек**: FastAPI (Python) + Svelte 5 + PostgreSQL

---

## Содержание

1. [Общее описание](#общее-описание)
2. [Система пользователей](#система-пользователей)
3. [Упражнения](#упражнения)
4. [Тренировки и комплексы](#тренировки-и-комплексы)
5. [Геймификация](#геймификация)
6. [Социальные функции](#социальные-функции)
7. [Магазин](#магазин)
8. [Уведомления](#уведомления)
9. [Техническая архитектура](#техническая-архитектура)

---

## Общее описание

BodyWeight — это геймифицированное фитнес-приложение для тренировок с собственным весом, реализованное как Telegram Mini App. Приложение помогает пользователям заниматься спортом, отслеживать прогресс и соревноваться с друзьями.

### Ключевые особенности

- **100+ упражнений** с анимациями и описаниями
- **Готовые комплексы тренировок** для разного оборудования
- **Создание собственных комплексов**
- **Система уровней и опыта (XP)**
- **Достижения и награды**
- **Таблицы лидеров** (глобальные, недельные, среди друзей)
- **Система друзей**
- **Магазин** с косметическими предметами

---

## Система пользователей

### Аутентификация

Аутентификация происходит автоматически через Telegram Mini App API:
- Валидация `initData` от Telegram
- Автоматическое создание профиля при первом входе
- Синхронизация данных Telegram (имя, username, фото)

### Профиль пользователя

| Поле | Описание |
|------|----------|
| `telegram_id` | Уникальный ID в Telegram |
| `username` | @username в Telegram |
| `first_name`, `last_name` | Имя пользователя |
| `avatar_id` | Выбранный аватар (1-12) |
| `level` | Текущий уровень |
| `total_xp` | Накопленный опыт |
| `coins` | Монеты для магазина |
| `current_streak` | Текущая серия дней |
| `max_streak` | Рекорд серии |

### Аватары

12 пиксельных аватаров на выбор:
- Воин, Маг, Лучник, Целитель
- Рыцарь, Разбойник, Берсерк, Паладин
- Ниндзя, Самурай, Монах, Друид

### Онбординг

Новые пользователи проходят онбординг:
1. Приветствие
2. Выбор аватара
3. Базовая информация о системе

---

## Упражнения

### Категории

| Категория | Slug | Описание |
|-----------|------|----------|
| Силовые | `strength` | Отжимания, подтягивания, приседания |
| Статика | `static` | Планка, уголок, стойки |
| Кардио | `cardio` | Прыжки, бег на месте, бёрпи |
| Динамическая растяжка | `dynamic-stretch` | Махи, вращения, выпады |
| Статическая растяжка | `static-stretch` | Позы для растяжки мышц |

### Атрибуты упражнения

| Атрибут | Описание |
|---------|----------|
| `slug` | Уникальный идентификатор |
| `name_ru` / `name_en` | Название на двух языках |
| `description_ru` / `description_en` | Описание техники |
| `difficulty` | Сложность (1-5 звёзд) |
| `base_xp` | Базовый опыт за повторение |
| `required_level` | Минимальный уровень для упражнения |
| `equipment` | Снаряжение: `none`, `pullup-bar`, `dip-bars`, `bench`, `wall` |
| `is_timed` | Упражнение на время (true) или на повторения (false) |
| `tags` | Теги: группы мышц, тип нагрузки |

### Прогрессия упражнений

Каждое упражнение может иметь:
- `easier_exercise_id` — более лёгкая версия
- `harder_exercise_id` — более сложная версия

Это создаёт цепочки прогрессии, например:
```
Отжимания с колен → Классические отжимания → Алмазные отжимания → Отжимания лучника
```

### Избранные упражнения

Пользователи могут добавлять упражнения в избранное (кнопка-сердце) для быстрого доступа.

### Анимации

Для каждого упражнения доступна SVG-анимация в папке `/sprites/exercises/`.

---

## Тренировки и комплексы

### Типы тренировок

#### 1. Готовые комплексы

Предустановленные программы тренировок:

| Категория | Описание | Снаряжение |
|-----------|----------|------------|
| Зарядка (`morning`) | Утренние разминки 5-15 мин | Без снаряжения |
| Дома (`home`) | Домашние тренировки | Без снаряжения |
| Турник (`pullup-bar`) | Программы для турника | Турник |
| Брусья (`dip-bars`) | Программы для брусьев | Брусья |

Каждый комплекс содержит:
- Название и описание
- Список упражнений с целевыми повторениями/временем
- Время отдыха между упражнениями
- Оценку длительности

#### 2. Собственные комплексы

Пользователи могут создавать свои комплексы:
- Название и описание
- Тип: зарядка, тренировка, растяжка
- Выбор упражнений из каталога
- Настройка повторений/времени для каждого
- Настройка времени отдыха
- Изменение порядка упражнений
- Дублирование существующих комплексов

#### 3. Свободная тренировка

Выбор отдельных упражнений для тренировки без комплекса.

### Плеер тренировки

Во время тренировки:
- Отображение текущего упражнения с анимацией
- Таймер тренировки
- Кнопки: завершить подход, пропустить, показать подсказку
- Ввод количества повторений
- Таймер отдыха между подходами
- Прогресс-бар по упражнениям

### Завершение тренировки

По окончании показывается:
- Общее время тренировки
- Количество выполненных упражнений
- Заработанный XP (с бонусами)
- Заработанные монеты (если есть)
- Новые достижения

---

## Геймификация

### Система уровней

Формула XP для уровня: `100 × level²`

| Уровень | Требуемый XP | Накопительно |
|---------|--------------|--------------|
| 1 | 0 | 0 |
| 2 | 100 | 100 |
| 3 | 400 | 500 |
| 5 | 1600 | 3000 |
| 10 | 8100 | 28500 |

### Расчёт XP

Полная формула:
```
XP = base_xp × difficulty_mult × streak_mult × volume_mult × first_bonus
```

#### Множители сложности (difficulty_mult)
Формула: `1 + (difficulty - 1) × 0.25`

| Сложность | Множитель |
|-----------|-----------|
| ★ (1) | ×1.0 |
| ★★ (2) | ×1.25 |
| ★★★ (3) | ×1.5 |
| ★★★★ (4) | ×1.75 |
| ★★★★★ (5) | ×2.0 |

#### Множитель объёма (volume_mult)
С убывающим эффектом после 20 повторений:
- До 20 повторов: `1 + reps × 0.02` (от 1.0 до 1.4)
- После 20: `1.4 + (reps - 20) × 0.01` (замедленный рост)

#### Бонусы к XP

| Бонус | Условие | Множитель |
|-------|---------|-----------|
| Серия (streak_mult) | Текущий streak | `1 + min(days, 30) × 0.0167` (до ×1.5) |
| Первая тренировка дня | Первая за день | ×1.2 |

### Система монет

Монеты — редкая валюта для магазина.

Способы заработка:
- Высокий XP за тренировку (500+ XP): 1-3 монеты
- Вехи серии (каждые 7 дней): 1 монета
- Длинные тренировки (45+ минут): 1-2 монеты

### Серия (Streak)

- Увеличивается при тренировке в новый день
- Сбрасывается, если пропущен день
- Влияет на бонус XP
- Отслеживается максимальная серия

### Достижения

20+ достижений в нескольких категориях:

#### Тренировки
| Достижение | Условие |
|------------|---------|
| Первый шаг | 1 тренировка |
| Десятка | 10 тренировок |
| Полтинник | 50 тренировок |
| Сотня | 100 тренировок |

#### Серия
| Достижение | Условие |
|------------|---------|
| На разгоне | 3 дня подряд |
| Неделя силы | 7 дней |
| Две недели | 14 дней |
| Месяц дисциплины | 30 дней |
| Легенда | 100 дней |

#### Уровень
| Достижение | Условие |
|------------|---------|
| Новичок | Уровень 5 |
| Любитель | Уровень 10 |
| Спортсмен | Уровень 25 |
| Атлет | Уровень 50 |

#### Специальные
- Утренняя тренировка до 7:00
- Вечерняя тренировка после 22:00
- Упражнения определённых типов
- И другие...

Каждое достижение даёт XP и иногда монеты.

---

## Социальные функции

### Друзья

Система двусторонней дружбы:
1. Отправка запроса (по user_id или username)
2. Принятие/отклонение запроса
3. Удаление из друзей

Статусы дружбы:
- `pending` — ожидает подтверждения
- `accepted` — друзья
- `blocked` — заблокирован

### Поиск пользователей

Поиск по:
- Username (@nickname)
- Имени

### Таблицы лидеров

| Тип | Описание | Сортировка |
|-----|----------|------------|
| Глобальный | Все пользователи | По общему XP |
| Недельный | XP за текущую неделю | По XP недели |
| Друзья | Только друзья | По общему XP |

Отображается:
- Топ-50 пользователей
- Позиция текущего пользователя
- Подиум для топ-3 (с анимацией)
- Аватары и уровни

---

## Магазин

### Типы предметов

| Тип | Описание | Примеры |
|-----|----------|---------|
| `title` | Титулы под именем | "Чемпион", "Воин" |
| `badge` | Значки профиля | Иконки, символы |
| `theme` | Темы оформления | Цветовые схемы |

### Покупка

- Предметы покупаются за монеты
- Некоторые требуют минимальный уровень
- Купленные предметы сохраняются навсегда

### Экипировка

- Можно надеть один предмет каждого типа
- Экипированные предметы видны в профиле
- Смена экипировки бесплатна

---

## Уведомления

### Типы уведомлений

| Тип | Описание |
|-----|----------|
| `friend_request` | Входящий запрос в друзья |
| `friend_accepted` | Запрос принят |
| `daily_reminder` | Напоминание о тренировке |
| `inactivity_reminder` | Уведомление о неактивности |

### Настройки

Пользователь может:
- Включить/выключить уведомления
- Настроить время напоминания

---

## Техническая архитектура

### Backend

```
backend/
├── app/
│   ├── api/
│   │   ├── routes/          # API эндпоинты
│   │   │   ├── auth.py
│   │   │   ├── users.py
│   │   │   ├── exercises.py
│   │   │   ├── workouts.py
│   │   │   ├── custom_routines.py
│   │   │   ├── achievements.py
│   │   │   ├── leaderboard.py
│   │   │   ├── friends.py
│   │   │   ├── shop.py
│   │   │   ├── notifications.py
│   │   │   └── goals.py
│   │   └── deps.py          # Зависимости (auth, DB)
│   ├── db/
│   │   └── models.py        # SQLAlchemy модели
│   ├── services/
│   │   ├── xp_calculator.py # Расчёт XP
│   │   ├── achievement_checker.py
│   │   └── notifications.py
│   └── data/
│       ├── exercises/       # JSON с упражнениями
│       ├── routines/        # JSON с комплексами
│       └── achievements.json
```

### Frontend

```
frontend/mini-app/
├── src/
│   ├── routes/              # SvelteKit страницы
│   │   ├── +page.svelte     # Главная
│   │   ├── workout/         # Тренировка
│   │   ├── profile/         # Профиль
│   │   ├── achievements/    # Достижения
│   │   ├── friends/         # Друзья
│   │   └── leaderboard/     # Рейтинг
│   ├── lib/
│   │   ├── components/      # Svelte компоненты
│   │   │   ├── ui/          # UI kit (Pixel*)
│   │   │   ├── RoutinePlayer.svelte
│   │   │   ├── CustomRoutineEditor.svelte
│   │   │   └── ...
│   │   ├── stores/          # Svelte 5 stores
│   │   │   ├── user.svelte.ts
│   │   │   ├── workout.svelte.ts
│   │   │   ├── favorites.svelte.ts
│   │   │   └── telegram.svelte.ts
│   │   ├── api/
│   │   │   └── client.ts    # API клиент
│   │   └── types/
│   │       └── index.ts     # TypeScript типы
│   └── static/
│       └── sprites/         # SVG анимации
```

### База данных

PostgreSQL с таблицами:
- `users` — пользователи
- `exercise_categories` — категории
- `exercises` — упражнения
- `workout_sessions` — тренировки
- `workout_exercises` — упражнения в тренировке
- `user_achievements` — достижения
- `user_goals` — цели
- `friendships` — друзья
- `notifications` — уведомления
- `shop_items` — товары
- `user_purchases` — покупки
- `user_exercise_progress` — прогресс
- `user_favorite_exercises` — избранное
- `user_custom_routines` — комплексы
- `user_custom_routine_exercises` — упражнения в комплексах

### API

RESTful API на FastAPI:
- Авторизация через Telegram init data
- JSON responses
- Async SQLAlchemy
- Pydantic модели

### Стилизация

Пиксельный стиль с:
- CSS переменными для темы
- Компонентами `Pixel*` (PixelButton, PixelCard, etc.)
- Адаптивным дизайном для мобильных
- Тёмной темой по умолчанию

---

## Ссылки

- [Telegram Mini Apps](https://core.telegram.org/bots/webapps)
- [Svelte 5 Runes](https://svelte.dev/docs/svelte/runes)
- [FastAPI](https://fastapi.tiangolo.com/)
